---
import teamData from '../data/team.json';
---

<div class="team-carousel-wrapper">
  <div class="team-carousel-container">
    <div class="team-carousel" id="team-carousel">
      <div class="carousel-track">
        {teamData.map((member) => (
          <div class="carousel-slide">
            <div class="team-card">
              <div class="card-content">
                <!-- Avatar Section -->
                <div class="avatar-section" data-member-name={member.name} data-member-image={member.image || ''}>
                  {member.image ? (
                    <img 
                      src={member.image} 
                      alt={`${member.name} - ${member.role}`}
                      class="team-avatar"
                      loading="lazy"
                      data-member-name={member.name}
                    />
                  ) : (
                    <div class="avatar-placeholder">
                      <span class="avatar-initial">{member.name.charAt(0)}</span>
                    </div>
                  )}
                </div>
                
                <!-- Content Section -->
                <div class="content-section">
                  <h3 class="team-name">{member.name}</h3>
                  <p class="team-role">{member.role}</p>
                  <p class="team-bio">{member.bio}</p>
                  
                  <!-- Social Links -->
                  <div class="team-social">
                    {member.linkedin && (
                      <a
                        href={member.linkedin}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="social-link linkedin"
                        aria-label={`${member.name}'s LinkedIn`}
                      >
                        <svg viewBox="0 0 24 24" fill="currentColor">
                          <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                        </svg>
                      </a>
                    )}
                    {member.twitter && (
                      <a
                        href={member.twitter}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="social-link twitter"
                        aria-label={`${member.name}'s Twitter`}
                      >
                        <svg viewBox="0 0 24 24" fill="currentColor">
                          <path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"/>
                        </svg>
                      </a>
                    )}
                  </div>
                </div>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>

    <!-- Navigation Buttons -->
    <button
      class="nav-button prev"
      id="team-prev"
      aria-label="Previous team member"
    >
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M15 18l-6-6 6-6"/>
      </svg>
    </button>
    
    <button
      class="nav-button next"
      id="team-next"
      aria-label="Next team member"
    >
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M9 18l6-6-6-6"/>
      </svg>
    </button>

    <!-- Dot Indicators -->
    <div class="carousel-dots" id="team-dots" aria-label="Team navigation"></div>
  </div>
</div>

<script>
  const initTeamCarousel = () => {
    const carousel = document.getElementById('team-carousel');
    const track = carousel?.querySelector('.carousel-track');
    const dotsContainer = document.getElementById('team-dots');
    const prevBtn = document.getElementById('team-prev');
    const nextBtn = document.getElementById('team-next');
    
    if (!carousel || !track || !dotsContainer) return;
    
    // Handle image load errors
    const avatarImages = carousel.querySelectorAll('.team-avatar');
    
    avatarImages.forEach((img) => {
      if (img instanceof HTMLImageElement) {
        img.addEventListener('error', function() {
          const memberName = img.dataset.memberName || 'Unknown';
          const avatarSection = img.closest('.avatar-section');
          if (avatarSection) {
            const placeholder = document.createElement('div');
            placeholder.className = 'avatar-placeholder';
            const initial = document.createElement('span');
            initial.className = 'avatar-initial';
            initial.textContent = memberName.charAt(0);
            placeholder.appendChild(initial);
            avatarSection.replaceChild(placeholder, img);
          }
        });
      }
    });

    const slides = Array.from(track.children);
    const totalSlides = slides.length;
    let currentIndex = 0;
    let autoplayInterval = null;
    let isPaused = false;

    // Create dots
    slides.forEach((_, idx) => {
      const dot = document.createElement('button');
      dot.className = `carousel-dot ${idx === 0 ? 'active' : ''}`;
      dot.setAttribute('aria-label', `Go to team member ${idx + 1}`);
      dot.addEventListener('click', () => {
        currentIndex = idx;
        updateCarousel();
        resetAutoplay();
      });
      dotsContainer.appendChild(dot);
    });

    const dots = Array.from(dotsContainer.children);

    const updateCarousel = () => {
      const offset = -currentIndex * 100;
      if (track instanceof HTMLElement) {
        track.style.transform = `translateX(${offset}%)`;
      }
      
      dots.forEach((dot, idx) => {
        if (dot instanceof HTMLElement) {
          dot.classList.toggle('active', idx === currentIndex);
        }
      });
    };

    const nextSlide = () => {
      currentIndex = (currentIndex + 1) % totalSlides;
      updateCarousel();
    };

    const prevSlide = () => {
      currentIndex = (currentIndex - 1 + totalSlides) % totalSlides;
      updateCarousel();
    };

    const startAutoplay = () => {
      if (autoplayInterval !== null) return;
      autoplayInterval = window.setInterval(() => {
        if (!isPaused) {
          nextSlide();
        }
      }, 4000);
    };

    const stopAutoplay = () => {
      if (autoplayInterval !== null) {
        clearInterval(autoplayInterval);
        autoplayInterval = null;
      }
    };

    const resetAutoplay = () => {
      stopAutoplay();
      if (!isPaused) {
        startAutoplay();
      }
    };

    prevBtn?.addEventListener('click', () => {
      prevSlide();
      resetAutoplay();
    });

    nextBtn?.addEventListener('click', () => {
      nextSlide();
      resetAutoplay();
    });

    carousel.addEventListener('mouseenter', () => {
      isPaused = true;
      stopAutoplay();
    });

    carousel.addEventListener('mouseleave', () => {
      isPaused = false;
      startAutoplay();
    });

    // Touch/swipe support
    let touchStartX = 0;
    let touchEndX = 0;

    carousel.addEventListener('touchstart', (e) => {
      touchStartX = e.touches[0].clientX;
    });

    carousel.addEventListener('touchend', (e) => {
      touchEndX = e.changedTouches[0].clientX;
      const swipeThreshold = 50;
      const diff = touchStartX - touchEndX;

      if (Math.abs(diff) > swipeThreshold) {
        if (diff > 0) {
          nextSlide();
        } else {
          prevSlide();
        }
        resetAutoplay();
      }
    });

    startAutoplay();
  };

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initTeamCarousel);
  } else {
    initTeamCarousel();
  }
</script>

<style>
  .team-carousel-wrapper {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    overflow: visible;
    position: relative;
  }

  .team-carousel-container {
    position: relative;
    padding: 0 60px;
    overflow: visible;
  }

  .team-carousel {
    position: relative;
    width: 100%;
    overflow: hidden;
    border-radius: var(--radius-lg);
  }

  .carousel-track {
    display: flex;
    transition: transform 0.5s ease-out;
    will-change: transform;
  }

  .carousel-slide {
    min-width: 100%;
    flex-shrink: 0;
    padding: 0 16px;
    box-sizing: border-box;
  }

  .team-card {
    background: var(--color-white);
    border-radius: var(--radius-lg);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    transition: all var(--transition-base);
    overflow: hidden;
    max-width: 900px;
    margin: 0 auto;
  }

  .team-card:hover {
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    transform: scale(1.02);
  }

  .card-content {
    padding: 48px;
    display: flex;
    flex-direction: row;
    align-items: flex-start;
    gap: 32px;
    overflow: hidden;
    position: relative;
    isolation: isolate;
  }

  .avatar-section {
    flex-shrink: 0;
    width: 160px;
    min-width: 160px;
    max-width: 160px;
    position: relative;
    z-index: 2;
    isolation: isolate;
  }

  .team-avatar {
    width: 160px;
    height: 160px;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid rgba(130, 232, 200, 0.2);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    transition: all var(--transition-base);
    display: block;
    position: relative;
    z-index: 2;
  }

  .team-card:hover .team-avatar {
    border-color: var(--color-primary);
    box-shadow: 0 12px 24px rgba(130, 232, 200, 0.3);
  }

  .avatar-placeholder {
    width: 160px;
    height: 160px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    border: 4px solid rgba(130, 232, 200, 0.2);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    position: relative;
    overflow: hidden;
    flex-shrink: 0;
    z-index: 2;
  }

  .avatar-placeholder::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(130, 232, 200, 0.3) 0%, rgba(21, 207, 170, 0.3) 100%);
    background-size: 200% 200%;
    animation: gradient-shift 3s ease infinite;
  }

  @keyframes gradient-shift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  .avatar-initial {
    font-size: 72px;
    font-weight: var(--font-weight-bold);
    color: var(--color-white);
    text-transform: uppercase;
    position: relative;
    z-index: 1;
  }

  .content-section {
    flex: 1;
    display: flex;
    flex-direction: column;
    position: relative;
    z-index: 1;
    min-width: 0;
    overflow-wrap: break-word;
    word-wrap: break-word;
  }

  .team-name {
    color: var(--color-secondary);
    font-size: 36px;
    font-weight: var(--font-weight-bold);
    margin: 0 0 8px 0;
    line-height: 1.2;
    letter-spacing: -0.02em;
    overflow-wrap: break-word;
    word-wrap: break-word;
    hyphens: auto;
  }

  .team-role {
    color: var(--color-accent);
    font-size: 18px;
    font-weight: var(--font-weight-semibold);
    margin: 0 0 24px 0;
  }

  .team-bio {
    color: var(--color-text-light);
    font-size: 16px;
    line-height: 1.7;
    margin: 0 0 32px 0;
    flex-grow: 1;
  }

  .team-social {
    display: flex;
    gap: 16px;
  }

  .social-link {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all var(--transition-fast);
    text-decoration: none;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  .social-link.linkedin {
    background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
    color: var(--color-white);
  }

  .social-link.linkedin:hover {
    background: linear-gradient(135deg, var(--color-accent), var(--color-primary));
    transform: translateY(-2px) scale(1.1);
    box-shadow: 0 8px 16px rgba(21, 207, 170, 0.3);
  }

  .social-link.twitter {
    background: linear-gradient(135deg, #0ea5e9, #3b82f6);
    color: var(--color-white);
  }

  .social-link.twitter:hover {
    background: linear-gradient(135deg, #3b82f6, #0ea5e9);
    transform: translateY(-2px) scale(1.1);
    box-shadow: 0 8px 16px rgba(59, 130, 246, 0.3);
  }

  .social-link svg {
    width: 24px;
    height: 24px;
  }

  .nav-button {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 56px;
    height: 56px;
    border-radius: 50%;
    background: var(--color-white);
    border: none;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all var(--transition-fast);
    z-index: 20;
    color: var(--color-secondary);
    opacity: 1;
    visibility: visible;
  }

  .nav-button:hover {
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    transform: translateY(-50%) scale(1.1);
    background: var(--color-primary);
    color: var(--color-white);
  }

  .nav-button:focus {
    outline: 3px solid var(--color-accent);
    outline-offset: 2px;
  }

  .nav-button.prev {
    left: -28px;
  }

  .nav-button.next {
    right: -28px;
  }
  
  @media (max-width: 1024px) {
    .team-carousel-container {
      padding: 0 70px;
    }
    
    .nav-button.prev {
      left: -20px;
    }

    .nav-button.next {
      right: -20px;
    }
  }
  
  @media (max-width: 768px) {
    .team-carousel-container {
      padding: 0 60px;
    }
    
    .nav-button.prev {
      left: -15px;
    }

    .nav-button.next {
      right: -15px;
    }
  }

  .nav-button svg {
    width: 28px;
    height: 28px;
  }

  .carousel-dots {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-top: 32px;
  }

  .carousel-dot {
    width: 12px;
    height: 12px;
    border-radius: 6px;
    border: none;
    background: rgba(130, 232, 200, 0.3);
    cursor: pointer;
    transition: all var(--transition-fast);
    padding: 0;
  }

  .carousel-dot:hover {
    background: rgba(130, 232, 200, 0.5);
    transform: scale(1.2);
  }

  .carousel-dot.active {
    background: linear-gradient(135deg, var(--color-primary), var(--color-accent)) !important;
    width: 24px !important;
    height: 12px !important;
  }

  .carousel-dot:focus {
    outline: 2px solid var(--color-accent);
    outline-offset: 2px;
  }

  @media (max-width: 1024px) {
    .team-carousel-container {
      padding: 0 50px;
    }

    .card-content {
      padding: 40px;
      gap: 24px;
    }

    .team-avatar,
    .avatar-placeholder {
      width: 140px;
      height: 140px;
    }

    .avatar-initial {
      font-size: 64px;
    }

    .team-name {
      font-size: 32px;
    }
  }

  @media (max-width: 768px) {
    .team-carousel-container {
      padding: 0 60px;
    }

    .card-content {
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: 32px 24px;
      gap: 24px;
    }

    .avatar-section {
      width: 128px;
      min-width: 128px;
      max-width: 128px;
    }

    .team-avatar,
    .avatar-placeholder {
      width: 128px;
      height: 128px;
    }

    .avatar-initial {
      font-size: 56px;
    }

    .team-name {
      font-size: 28px;
    }

    .team-role {
      font-size: 16px;
    }

    .team-bio {
      font-size: 15px;
    }

    .team-social {
      justify-content: center;
    }

    .nav-button {
      width: 44px;
      height: 44px;
    }

    .nav-button svg {
      width: 20px;
      height: 20px;
    }

    .carousel-dots {
      margin-top: 24px;
      gap: 8px;
    }
    
    .carousel-dot {
      width: 10px;
      height: 10px;
    }
    
    .carousel-dot.active {
      width: 20px !important;
      height: 10px !important;
    }
  }

  @media (max-width: 480px) {
    .team-carousel-container {
      padding: 0 50px;
    }

    .card-content {
      padding: 24px 20px;
    }

    .avatar-section {
      width: 100px;
      min-width: 100px;
      max-width: 100px;
    }

    .team-avatar,
    .avatar-placeholder {
      width: 100px;
      height: 100px;
    }

    .avatar-initial {
      font-size: 48px;
    }

    .team-name {
      font-size: 24px;
    }
    
    .nav-button {
      width: 40px;
      height: 40px;
    }

    .nav-button svg {
      width: 18px;
      height: 18px;
    }
    
    .nav-button.prev {
      left: -15px;
    }

    .nav-button.next {
      right: -15px;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .carousel-track,
    .team-card,
    .team-avatar,
    .social-link,
    .nav-button {
      transition: none !important;
    }

    .avatar-placeholder::before {
      animation: none !important;
    }

    .team-card:hover {
      transform: none !important;
    }
  }
</style>

