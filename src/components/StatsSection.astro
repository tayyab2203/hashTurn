---
interface Props {
  stats: Array<{
    number: string;
    label: string;
    suffix?: string;
  }>;
}

const { stats } = Astro.props;
---

<section class="stats-section">
  <div class="container">
    <div class="stats-grid">
      {stats.map((stat) => (
        <div class="stat-item">
          <div class="stat-number" data-count={stat.number}>
            <span class="stat-value">0</span>
            {stat.suffix && <span class="stat-suffix">{stat.suffix}</span>}
          </div>
          <div class="stat-label">{stat.label}</div>
        </div>
      ))}
    </div>
  </div>
</section>

<script>
  const animateCounter = (element: HTMLElement, target: number, duration: number = 2000) => {
    const start = 0;
    const increment = target / (duration / 16);
    let current = start;
    
    const updateCounter = () => {
      current += increment;
      if (current < target) {
        element.textContent = Math.floor(current).toString();
        requestAnimationFrame(updateCounter);
      } else {
        element.textContent = target.toString();
      }
    };
    
    updateCounter();
  };

  const initStats = () => {
    const stats = document.querySelectorAll('.stat-item');
    
    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const statItem = entry.target;
          const valueElement = statItem.querySelector('.stat-value');
          const countAttr = statItem.querySelector('[data-count]')?.getAttribute('data-count');
          
          if (valueElement && countAttr && !valueElement.dataset.animated) {
            const target = parseInt(countAttr.replace(/\D/g, ''));
            valueElement.dataset.animated = 'true';
            animateCounter(valueElement, target);
          }
        }
      });
    }, { threshold: 0.5 });

    stats.forEach((stat) => observer.observe(stat));
  };

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initStats);
  } else {
    initStats();
  }
</script>

<style>
  .stats-section {
    padding: var(--spacing-2xl) 0;
    background: var(--gradient-hero);
    position: relative;
    overflow: hidden;
  }

  .stats-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at 30% 50%, rgba(21, 207, 170, 0.1), transparent 50%),
                radial-gradient(circle at 70% 50%, rgba(130, 232, 200, 0.1), transparent 50%);
    pointer-events: none;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-xl);
    position: relative;
    z-index: 1;
  }

  .stat-item {
    text-align: center;
    padding: var(--spacing-lg);
    background: var(--gradient-card);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
    transition: all var(--transition-base);
  }

  .stat-item:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
  }

  .stat-number {
    font-size: clamp(2.5rem, 5vw, 4rem);
    font-weight: 700;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: var(--spacing-sm);
    line-height: 1;
  }

  .stat-suffix {
    font-size: 0.6em;
    vertical-align: super;
  }

  .stat-label {
    font-size: 1.125rem;
    color: var(--color-text-light);
    font-weight: 500;
  }

  @media (max-width: 767px) {
    .stats-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: var(--spacing-md);
    }
  }

  [data-theme="dark"] .stats-section {
    background: linear-gradient(135deg, rgba(130, 232, 200, 0.1) 0%, rgba(21, 207, 170, 0.05) 50%, rgba(15, 23, 42, 0.8) 100%);
  }

  [data-theme="dark"] .stat-item {
    background: var(--gradient-card);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }
</style>

